<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Park Faaliyet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;font-family:sans-serif}
body{margin:0;padding:0;background:#111;color:#fff;font-size:16px}
input,textarea,button{width:100%;padding:8px;margin:5px 0}
button{cursor:pointer}
.card{background:#222;margin:5px;padding:10px;border-radius:8px;}
.card img{width:100px;height:100px;margin-right:5px;object-fit:cover;}
</style>
</head>
<body>

<h2>Park Faaliyet</h2>

<section id="add">
<h3>Yeni Kayıt</h3>
<label>Tarih:</label>
<input type="date" id="date">
<label>Açıklama:</label>
<textarea id="desc"></textarea>
<label>Resim 1:</label>
<input type="file" id="img1" accept="image/*">
<label>Resim 2:</label>
<input type="file" id="img2" accept="image/*">
<button id="saveBtn">Kaydet</button>
</section>

<section id="listSection">
<h3>Kayıtlar</h3>
<div id="cardsContainer"></div>
</section>

<script>
const DEPLOY_URL = "https://script.google.com/macros/s/AKfycbxLgR4Hb-VFRX6u98i0q0YKeqGfePDmRdpEeC3iMwnwVy-CKqx_ppLkKNmgHyYWmTCI0w/exec";

async function fetchData(){
  const res = await fetch(DEPLOY_URL);
  const data = await res.json();
  render(data);
}

function render(data){
  const container = document.getElementById("cardsContainer");
  container.innerHTML = "";
  data.forEach((r,i)=>{
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div><strong>${r.tarih}</strong></div>
      <div>${r.aciklama}</div>
      <div>${r.resim1 ? '<img src="'+r.resim1+'">' : ''}${r.resim2 ? '<img src="'+r.resim2+'">' : ''}</div>
    `;
    container.appendChild(card);
  });
}

// Dosyayı base64 olarak oku
function readFile(file){
  return new Promise((resolve,reject)=>{
    if(!file){resolve(""); return;}
    const reader = new FileReader();
    reader.onload = e=>resolve(e.target.result);
    reader.onerror = err=>reject(err);
    reader.readAsDataURL(file);
  });
}

document.getElementById("saveBtn").addEventListener("click", async ()=>{
  const tarih = document.getElementById("date").value;
  const desc = document.getElementById("desc").value;
  const img1 = await readFile(document.getElementById("img1").files[0]);
  const img2 = await readFile(document.getElementById("img2").files[0]);

  if(!tarih || !desc){alert("Tarih ve açıklama gerekli"); return;}

  fetch(DEPLOY_URL, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({tarih, aciklama:desc, resim1:img1, resim2:img2})
  }).then(res=>res.json()).then(res=>{
    if(res.status==="success"){
      alert("Kaydedildi!");
      document.getElementById("date").value="";
      document.getElementById("desc").value="";
      document.getElementById("img1").value="";
      document.getElementById("img2").value="";
      fetchData(); // listeyi güncelle
    } else alert("Hata: "+res.message);
  }).catch(console.error);
});

// İlk veri çek
fetchData();
</script>

</body>
</html>
