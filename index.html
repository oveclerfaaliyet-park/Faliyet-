<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Park Faaliyet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
body{margin:0;background:#000;color:#fff;font-size:16px;}
header{padding:10px;text-align:center;font-size:22px;font-weight:bold;}
nav{display:flex;justify-content:space-around;background:#111;padding:10px;}
nav button{padding:10px 15px;font-size:16px;}
section{display:none;padding:10px;height:calc(100vh - 120px);overflow:auto;}
section.active{display:block;}
input,textarea,button{width:100%;margin:6px 0;padding:10px;font-size:16px;}
textarea{height:150px;}
.card{display:flex;background:#222;margin:8px 0;border-radius:10px;overflow:hidden;cursor:pointer;}
.card img{width:120px;height:120px;object-fit:cover;margin-right:4px;}
.card div{padding:10px;flex:1;position:relative;}
.iconbar{display:flex;gap:15px;margin-top:10px;font-size:20px;justify-content:flex-end;position:absolute;top:10px;right:10px;}
.iconbar span{cursor:pointer;}
#searchBox{margin:3px 0;padding:8px;width:100%;font-size:16px;border-radius:6px;border:1px solid #ccc;}
</style>
</head>
<body>
<header>PARK FAALİYET</header>
<nav>
<button onclick="show('home')">Ana</button>
<button onclick="show('add')">Yeni</button>
<button onclick="show('settings')">Ayarlar</button>
</nav>

<section id="home" class="active">
<input type="text" id="searchBox" placeholder="Ara..." oninput="filter(this.value)">
<div id="cardsContainer" style="overflow-y:auto;max-height:calc(100vh-150px)"></div>
</section>

<section id="add">
<h3>Yeni Kayıt</h3>
<label>Tarih</label>
<input type="date" id="date">
<label>Resim 1</label>
<input type="file" id="img1" accept="image/*">
<label>Resim 2</label>
<input type="file" id="img2" accept="image/*">
<label>Açıklama</label>
<textarea id="desc" placeholder="Açıklama"></textarea>
<button id="saveBtn">Kaydet</button>
</section>

<section id="settings">
<h3>PDF / ZIP / Yedek</h3>
<label>Başlangıç Tarihi</label>
<input type="date" id="s1">
<label>Bitiş Tarihi</label>
<input type="date" id="s2">
<button id="pdfExport">PDF Oluştur</button>
<button id="zipExport">ZIP Dışa Aktar</button>
<input type="file" id="zipInput">
<button id="zipImport">ZIP İçe Aktar</button>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let data=[];
function show(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
if(id=='home') render();
}

function render(){
let container=document.getElementById("cardsContainer");
container.innerHTML="";
data.forEach((r,i)=>{
let c=document.createElement("div");
c.className="card";
c.innerHTML=`<img src="${r.resim1||''}"><div><b>${r.tarih}</b><br>${r.aciklama}<div class="iconbar"><span onclick="edit(${i})">✏️</span></div></div>`;
container.appendChild(c);
});
}

function filter(text){
document.querySelectorAll(".card").forEach(c=>{
c.style.display=c.innerText.toLowerCase().includes(text.toLowerCase())?"flex":"none";
});
}

document.getElementById('saveBtn').addEventListener('click', async function(){
let tarih=document.getElementById('date').value;
let desc=document.getElementById('desc').value;
let img1=document.getElementById('img1').files[0];
let img2=document.getElementById('img2').files[0];
if(!tarih||!desc){alert("Tarih ve açıklama gerekli!");return;}

let readFile= (file)=> new Promise((res,rej)=>{
if(!file){res("");return;}
let r=new FileReader();
r.onload=e=>res(e.target.result);
r.onerror=err=>rej(err);
r.readAsDataURL(file);
});

let r={tarih,aciklama:desc,resim1:await readFile(img1),resim2:await readFile(img2)};
data.push(r);
render();
document.getElementById('date').value="";
document.getElementById('desc').value="";
document.getElementById('img1').value="";
document.getElementById('img2').value="";

// --- E-Tabloya Gönder ---
fetch("https://script.google.com/macros/s/AKfycbyEevYqGCiK2iUv7olCmrOK8cajIyPVnNxjeM_HwXT-bMkaijxXxC5LWcslsV3Goiji6A/exec", {
method:"POST",
body: JSON.stringify(r)
}).then(res=>res.json()).then(console.log).catch(console.error);
});

document.getElementById('pdfExport').addEventListener('click',()=>{
const { jsPDF } = window.jspdf;
let doc = new jsPDF('p','mm','a4');
let colX=[10,70,130];
let y=10,rowH=55;
data.forEach((r,i)=>{
let col=colX[i%3];
if(i>0 && i%3===0) y+=rowH;
if(r.resim1) doc.addImage(r.resim1,'JPEG',col,y,55,35);
doc.text(r.tarih+" "+r.aciklama,col,y+40);
});
doc.save("faaliyet.pdf");
});

</script>
</body>
</html>
