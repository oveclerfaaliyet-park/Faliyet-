<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Park Faaliyet</title>
<style>
body{font-family:Arial,sans-serif;background:#111;color:#fff;padding:12px}
input,textarea,button{width:100%;padding:8px;margin:6px 0}
.card{background:#222;padding:10px;border-radius:8px;margin:8px 0}
.card img{max-width:120px;height:auto;margin-right:6px}
</style>
</head>
<body>
<h2>Park Faaliyet</h2>

<div>
  <label>Tarih</label>
  <input type="date" id="date">
  <label>Açıklama</label>
  <textarea id="desc"></textarea>
  <label>Resim 1</label>
  <input type="file" id="img1" accept="image/*">
  <label>Resim 2</label>
  <input type="file" id="img2" accept="image/*">
  <button id="saveBtn">Kaydet</button>
</div>

<hr>
<h3>Kayıtlar</h3>
<div id="cardsContainer">Yükleniyor...</div>

<script>
const DEPLOY_URL = "https://script.google.com/macros/s/AKfycbz7ZCgd7Lw7KnN_R6ckz-AKxUivBC2_EFtdh9ADsMx6q8mfHR_kN839f3bpg3gNA0b1Gw/exec";

function readFileBase64(file){
  return new Promise(resolve=>{
    if(!file){resolve(""); return;}
    const r = new FileReader();
    r.onload = e=>resolve(e.target.result);
    r.onerror=()=>resolve("");
    r.readAsDataURL(file);
  });
}

async function sendFormData(tarih, aciklama, r1, r2){
  const form = new FormData();
  form.append("tarih", tarih);
  form.append("aciklama", aciklama);
  form.append("resim1", r1||"");
  form.append("resim2", r2||"");
  const resp = await fetch(DEPLOY_URL, {method:"POST", body:form});
  return resp.json();
}

document.getElementById("saveBtn").addEventListener("click", async ()=>{
  const tarih=document.getElementById("date").value;
  const desc=document.getElementById("desc").value;
  if(!tarih||!desc){alert("Tarih ve açıklama gerekli");return;}
  const r1=await readFileBase64(document.getElementById("img1").files[0]);
  const r2=await readFileBase64(document.getElementById("img2").files[0]);

  try{
    const res=await sendFormData(tarih, desc, r1, r2);
    if(res.status==="success"){
      alert("Kaydedildi!");
      document.getElementById("date").value="";
      document.getElementById("desc").value="";
      document.getElementById("img1").value="";
      document.getElementById("img2").value="";
      loadData();
    }else{
      alert("Sunucu hatası: "+(res.message||"bilinmiyor"));
      console.error(res);
    }
  }catch(err){
    console.error(err);
    alert("Gönderme hatası. Konsolu kontrol et.");
  }
});

async function loadData(){
  const container=document.getElementById("cardsContainer");
  container.innerHTML="Yükleniyor...";
  try{
    const r=await fetch(DEPLOY_URL);
    const data=await r.json();
    container.innerHTML="";
    if(!Array.isArray(data)||data.length===0){container.innerHTML="Kayıt yok";return;}
    data.forEach(item=>{
      const div=document.createElement("div");
      div.className="card";
      const imgs=(item.resim1?`<img src="${item.resim1}">`:"")+(item.resim2?`<img src="${item.resim2}">`:"");
      div.innerHTML=`<div><strong>${item.tarih||""}</strong></div><div>${item.aciklama||""}</div><div>${imgs}</div>`;
      container.appendChild(div);
    });
  }catch(err){console.error(err);container.innerHTML="Veri yüklenemedi";}
}

window.addEventListener("load", loadData);
</script>
</body>
</html>
