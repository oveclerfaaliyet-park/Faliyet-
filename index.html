<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Park Faaliyet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CACHE KAPAT -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>

<link rel="manifest" href="manifest.json">

<style>
*{box-sizing:border-box;font-family:sans-serif}
body{margin:0;background:#fff;color:#000}
header{padding:10px;text-align:center;font-size:20px;font-weight:bold}
#cards{padding:10px}
.card{background:#f5f5f5;margin-bottom:10px;border-radius:10px;padding:10px}
.card img{width:48%;height:200px;object-fit:cover;border-radius:8px}
#addBtn{
position:fixed;bottom:20px;right:20px;
width:60px;height:60px;border-radius:50%;
background:#000;color:#fff;font-size:40px;border:none;
}
#addPanel{
position:fixed;top:0;left:0;width:100%;height:100%;
background:url("pexels-skylar-kang-6044198.jpg") center/cover;
display:none;padding:20px
}
input,textarea,button{width:100%;margin:5px 0;padding:8px}
video{
position:fixed;top:0;left:0;width:100%;height:100%;
object-fit:cover;z-index:9999;display:none
}
</style>
</head>
<body>

<video id="idleVideo" src="acilis.mp4" muted autoplay loop></video>

<header>Park Faaliyet</header>
<div id="cards"></div>

<button id="addBtn">+</button>

<div id="addPanel">
<h3>Yeni Kayıt</h3>
<input type="date" id="date">
<textarea id="desc" placeholder="Açıklama"></textarea>
<input type="file" id="img1">
<input type="file" id="img2">
<button onclick="save()">Kaydet</button>
<button onclick="closeAdd()">Kapat</button>
</div>

<script>
if('serviceWorker' in navigator){
navigator.serviceWorker.register("sw.js");
}

const URL="https://script.google.com/macros/s/AKfycbxAIVyi1HVm-230dheIyVWoYcZr7-8FE9YZNsOWXp1DijEYx39rZ1CW0XZIR7aBURvrJw/exec";

let idleTimer;
const video=document.getElementById("idleVideo");

function resetIdle(){
video.style.display="none";
clearTimeout(idleTimer);
idleTimer=setTimeout(()=>video.style.display="block",15000);
}
document.onclick=resetIdle;
document.onmousemove=resetIdle;
resetIdle();

async function loadData(){
const res=await fetch(URL);
const data=await res.json();
const c=document.getElementById("cards");
c.innerHTML="";
data.forEach(r=>{
c.innerHTML+=`
<div class="card">
<div><b>${r.tarih}</b></div>
<div>${r.aciklama}</div>
<div>
${r.resim1?`<img src="${r.resim1}">`:""}
${r.resim2?`<img src="${r.resim2}">`:""}
</div>
</div>`;
});
}

function readFile(f){
return new Promise(r=>{
const fr=new FileReader();
fr.onload=e=>r(e.target.result);
fr.readAsDataURL(f);
});
}

async function save(){
document.querySelector("button").innerText="Kaydediliyor...";
const data={
tarih:date.value,
aciklama:desc.value,
resim1:await readFile(img1.files[0]),
resim2:await readFile(img2.files[0])
};
await fetch(URL,{method:"POST",body:JSON.stringify(data)});
alert("Kaydedildi");
closeAdd();
loadData();
}

function closeAdd(){
addPanel.style.display="none";
}
addBtn.onclick=()=>addPanel.style.display="block";

loadData();
</script>
</body>
</html>
