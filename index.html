<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Park Faaliyet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#000;color:#fff;overflow:hidden}
video.bg{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;opacity:.4;z-index:-1}

header{text-align:center;padding:10px;font-size:22px;font-weight:bold}
nav{display:flex;justify-content:space-around;background:#111;padding:10px}
nav button{padding:8px 16px;font-size:16px}

section{display:none;padding:15px;height:calc(100vh - 120px);overflow:auto}
section.active{display:block}

input,textarea,button{width:100%;margin:6px 0;padding:10px;font-size:16px}
textarea{height:140px}

.card{background:#222;border-radius:10px;margin:10px 0;padding:10px;cursor:pointer;}
.card img{max-width:100%;border-radius:8px;margin-top:5px;}
.iconbar{display:flex;gap:15px;margin-top:6px;font-size:20px}

#search{padding:8px;border-radius:8px;margin-bottom:10px}
</style>
</head>
<body>

<video class="bg" autoplay muted loop id="bgvideo">
<source src="acilis.mp4" type="video/mp4">
</video>

<header>PARK FAALƒ∞YET</header>

<nav>
<button onclick="show('home')">Ana</button>
<button onclick="show('add')">Yeni</button>
<button onclick="show('settings')">Ayarlar</button>
</nav>

<section id="home" class="active">
<input id="search" placeholder="Ara..." oninput="render()">
<div id="list"></div>
</section>

<section id="add">
<h3>Yeni Kayƒ±t</h3>
<label>Dosya 1</label>
<input type="file" id="img1" accept="image/*">
<label>Dosya 2</label>
<input type="file" id="img2" accept="image/*">
<input type="date" id="date">
<textarea id="desc" placeholder="A√ßƒ±klama"></textarea>
<button onclick="save()">Kaydet</button>
</section>

<section id="settings">
<h3>Yedek</h3>
<label>Ba≈ülangƒ±√ß</label>
<input type="date" id="s1">
<label>Biti≈ü</label>
<input type="date" id="s2">
<button onclick="exportZip()">ZIP Dƒ±≈üa Aktar</button>
<input type="file" id="zipInput">
<button onclick="importZip()">ZIP ƒ∞√ße Aktar</button>

<h3>√á√∂p Kutusu</h3>
<div id="trash"></div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script>
if("serviceWorker" in navigator){navigator.serviceWorker.register("sw.js");}

let data = JSON.parse(localStorage.getItem("data")||"[]");
let trash = JSON.parse(localStorage.getItem("trash")||"[]");

let timer;
function resetTimer(){
  clearTimeout(timer);
  timer=setTimeout(()=>{document.getElementById("bgvideo").play();},20000);
}
document.onclick=resetTimer;
resetTimer();

function show(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
render();
}

function save(){
if(!img1.files[0] && !img2.files[0]){alert("En az bir resim se√ß"); return;}
let r={date:date.value,desc:desc.value,img1:"",img2:""};
let reader1=new FileReader();
reader1.onload=e=>{
r.img1=e.target.result;
if(img2.files[0]){
let reader2=new FileReader();
reader2.onload=e2=>{
r.img2=e2.target.result;
addRecord(r);
};
reader2.readAsDataURL(img2.files[0]);
}else addRecord(r);
};
if(img1.files[0]) reader1.readAsDataURL(img1.files[0]);
else if(img2.files[0]){
let reader2=new FileReader();
reader2.onload=e2=>{
r.img2=e2.target.result;
addRecord(r);
};
reader2.readAsDataURL(img2.files[0]);
}

function addRecord(r){
let duplicate=data.find(d=>d.date===r.date && d.desc===r.desc);
if(duplicate){alert("Aynƒ± tarih ve a√ßƒ±klama zaten var!"); return;}
data.push(r);
localStorage.setItem("data",JSON.stringify(data));
img1.value=""; img2.value=""; desc.value=""; date.value="";
render(); show("home");
}

function render(){
let q=search.value.toLowerCase();
let list=document.getElementById("list");
list.innerHTML="";
data.sort((a,b)=> new Date(b.date)-new Date(a.date));
data.filter(x=> (x.date+x.desc).toLowerCase().includes(q))
.forEach((r,i)=>{
list.innerHTML+=`
<div class="card" onclick="view(${i})">
<b>${r.date}</b><br>${r.desc}
<div class="iconbar">
<span onclick="event.stopPropagation();edit(${i})">‚úèÔ∏è</span>
<span onclick="event.stopPropagation();del(${i})">üóëÔ∏è</span>
</div>
</div>`;
});
renderTrash();
}

function view(i){
let r=data[i];
let html=`<div class="card">`;
if(r.img1) html+=`<img src="${r.img1}">`;
if(r.img2) html+=`<img src="${r.img2}">`;
html+=`<b>${r.date}</b><br>${r.desc}</div>`;
let w=window.open(); w.document.write(html);
}

function del(i){
trash.push(data[i]);
data.splice(i,1);
localStorage.setItem("data",JSON.stringify(data));
localStorage.setItem("trash",JSON.stringify(trash));
render();
}

function renderTrash(){
trashDiv=document.getElementById("trash"); trashDiv.innerHTML="";
trash.forEach((r,i)=>{
trashDiv.innerHTML+=`
<div class="card">
${r.date} - ${r.desc}
<div class="iconbar">
<span onclick="event.stopPropagation();restore(${i})">‚ôªÔ∏è</span>
<span onclick="event.stopPropagation();perma(${i})">‚ùå</span>
</div>
</div>`;
});
}

function restore(i){data.push(trash[i]); trash.splice(i,1); localStorage.setItem("data",JSON.stringify(data)); localStorage.setItem("trash",JSON.stringify(trash)); render();}
function perma(i){trash.splice(i,1); localStorage.setItem("trash",JSON.stringify(trash)); render();}

async function exportZip(){
let zip=new JSZip();
data.forEach((r,i)=>zip.file(i+".json",JSON.stringify(r)));
let blob=await zip.generateAsync({type:"blob"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="yedek.zip";a.click();
}

async function importZip(){
let zip=await JSZip.loadAsync(zipInput.files[0]);
for(let f in zip.files){
let t=await zip.files[f].async("string");
data.push(JSON.parse(t));
}
localStorage.setItem("data",JSON.stringify(data));
render();
}

function edit(i){alert("D√ºzenleme sonra eklenir");}
render();
</script>
</body>
</html>
