<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Park Faaliyet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;font-family:sans-serif}
body{margin:0;padding:10px;background:#f2f2f2;color:#000}
h2{text-align:center}
input,textarea,button{width:100%;padding:10px;margin:6px 0;font-size:16px}
button{background:#2196f3;color:#fff;border:none;border-radius:6px}
button:disabled{background:#999}
.card{background:#fff;margin:10px 0;padding:10px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.2)}
.card img{width:48%;height:200px;object-fit:cover;margin:1%}
#loading{display:none;text-align:center;font-size:18px;margin:10px}
#addBtn{position:fixed;right:20px;bottom:20px;width:60px;height:60px;border-radius:50%;font-size:30px}
#formBox{display:none;background:#fff;padding:10px;border-radius:10px}
</style>
</head>
<body>

<h2>Park Faaliyet</h2>

<div id="loading">⏳ Kayıt yapılıyor...</div>

<div id="formBox">
  <h3>Yeni Kayıt</h3>
  <input type="date" id="date">
  <textarea id="desc" placeholder="Açıklama"></textarea>
  <input type="file" id="img1" accept="image/*">
  <input type="file" id="img2" accept="image/*">
  <button id="saveBtn">Kaydet</button>
</div>

<div id="cardsContainer"></div>

<button id="addBtn">+</button>

<script>
const DEPLOY_URL = "https://script.google.com/macros/s/AKfycbxAIVyi1HVm-230dheIyVWoYcZr7-8FE9YZNsOWXp1DijEYx39rZ1CW0XZIR7aBURvrJw/exec";

let sending = false;

async function fetchData(){
  const res = await fetch(DEPLOY_URL);
  const data = await res.json();
  render(data);
}

function render(data){
  const box = document.getElementById("cardsContainer");
  box.innerHTML="";
  data.reverse().forEach(r=>{
    box.innerHTML += `
      <div class="card">
        <div>
          ${r.resim1 ? `<img src="${r.resim1}">` : ""}
          ${r.resim2 ? `<img src="${r.resim2}">` : ""}
        </div>
        <div><b>${r.tarih}</b></div>
        <div>${r.aciklama}</div>
      </div>
    `;
  });
}

function readFile(file){
  return new Promise(res=>{
    if(!file){res(""); return;}
    const fr=new FileReader();
    fr.onload=e=>res(e.target.result);
    fr.readAsDataURL(file);
  });
}

document.getElementById("addBtn").onclick=()=>{
  document.getElementById("formBox").style.display="block";
};

document.getElementById("saveBtn").onclick=async()=>{
  if(sending) return;
  sending=true;

  const tarih=date.value;
  const aciklama=desc.value;
  if(!tarih||!aciklama){alert("Tarih ve açıklama zorunlu"); sending=false; return;}

  loading.style.display="block";
  saveBtn.disabled=true;

  const r1=await readFile(img1.files[0]);
  const r2=await readFile(img2.files[0]);

  fetch(DEPLOY_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({tarih,aciklama,resim1:r1,resim2:r2})
  }).then(r=>r.json()).then(r=>{
    alert("Kaydedildi");
    formBox.style.display="none";
    loading.style.display="none";
    saveBtn.disabled=false;
    sending=false;
    date.value="";desc.value="";img1.value="";img2.value="";
    fetchData();
  }).catch(err=>{
    alert("Hata");
    console.log(err);
    sending=false;
  });
};

fetchData();
</script>
</body>
</html>
