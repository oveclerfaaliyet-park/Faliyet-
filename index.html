<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Park Faaliyet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">
<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;overflow:hidden;background:#000;color:#fff}
video.bg{
position:fixed;top:0;left:0;width:100%;height:100%;
object-fit:cover;z-index:-2;opacity:.4
}
#screensaver{
position:fixed;top:0;left:0;width:100%;height:100%;
background:black;z-index:10;display:none
}
#screensaver video{width:100%;height:100%;object-fit:cover}

header{padding:10px;text-align:center;font-size:22px;font-weight:bold}
nav{display:flex;justify-content:space-around;background:#111;padding:10px}
nav button{padding:10px 20px;font-size:16px}

section{display:none;padding:15px;height:calc(100vh - 120px);overflow:auto}
section.active{display:block}

label{font-size:14px;opacity:.8}

input,textarea,button{width:100%;margin:8px 0;padding:12px;font-size:16px}
textarea{height:160px}

.card{
display:flex;background:#222;margin:10px 0;border-radius:10px;overflow:hidden
}
.card img{width:120px;height:120px;object-fit:cover}
.card div{padding:10px}

.iconbar{
display:flex;
gap:15px;
margin-top:10px;
font-size:22px;
justify-content:flex-end;
}

.iconbar span{
cursor:pointer;
}

.trashItem{
display:flex;
justify-content:space-between;
align-items:center;
background:#222;
margin:8px 0;
padding:10px;
border-radius:8px;
}

.trashIcons span{
font-size:20px;
margin-left:15px;
cursor:pointer;
}

#detail img{width:100%;margin-top:50px}
#detail .text{padding:10px;font-size:18px}

/* Arama Ã§ubuÄŸu sabit ve panelle arasÄ± yarÄ± yarÄ±ya */
#searchBar{
position:sticky;
top:60px;
background:#111;
padding:5px;
z-index:5;
}

#searchBar input{
width:100%;
padding:8px;
font-size:16px;
}
</style>
</head>
<body>

<video class="bg" autoplay muted loop>
<source src="acilis.mp4" type="video/mp4">
</video>

<div id="screensaver">
<video autoplay muted loop>
<source src="acilis.mp4" type="video/mp4">
</video>
</div>

<header>PARK FAALÄ°YET</header>

<nav>
<button onclick="show('home')">Ana</button>
<button onclick="show('add')">Yeni</button>
<button onclick="show('settings')">Ayarlar</button>
</nav>

<section id="home" class="active">
<div id="searchBar"><input type="text" placeholder="Ara..." oninput="filterRecords(this.value)"></div>
</section>

<section id="add">
<h3>Yeni KayÄ±t</h3>
<label>Tarih</label>
<input type="date" id="date">
<input type="file" id="img1" accept="image/*">
<input type="file" id="img2" accept="image/*">
<label>AÃ§Ä±klama</label>
<textarea id="desc" placeholder="AÃ§Ä±klama"></textarea>
<button onclick="save()">Kaydet</button>
</section>

<section id="detail"></section>

<section id="settings">
<h3>Yedek</h3>

<label>BaÅŸlangÄ±Ã§ Tarihi</label>
<input type="date" id="s1">

<label>BitiÅŸ Tarihi</label>
<input type="date" id="s2">

<div id="lastBackup" style="margin:10px 0;font-size:14px"></div>

<button onclick="exportZip()">ZIP DÄ±ÅŸa Aktar</button>

<input type="file" id="zipInput">
<button onclick="importZip()">ZIP Ä°Ã§e Aktar</button>

<h3>Ã‡Ã¶p Kutusu</h3>
<button onclick="showTrash()">Ã‡Ã¶p Kutusunu AÃ§</button>
<div id="trash"></div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script>
let data = JSON.parse(localStorage.getItem("records")||"[]");
let trash = JSON.parse(localStorage.getItem("trash")||"[]");
let lastSave=0;
let idleTimer;

function resetIdle(){
clearTimeout(idleTimer);
screensaver.style.display="none";
idleTimer=setTimeout(()=>screensaver.style.display="block",20000);
}
document.onclick=resetIdle;resetIdle();

function show(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
if(id=="home") render();
}

function save(){
if(Date.now()-lastSave<2000)return;
lastSave=Date.now();

if(!date.value){alert("Tarih seÃ§iniz");return;}
if(!desc.value){alert("AÃ§Ä±klama giriniz");return;}

let r={date:date.value,desc:desc.value,imgs:[],time:Date.now()};

if(data.find(x=>x.date==r.date && x.desc==r.desc)){alert("Bu kayÄ±t zaten var");return;}

let files=[img1,img2].filter(f=>f.files[0]);
if(files.length===0){
data.push(r);
data.sort((a,b)=>new Date(b.date)-new Date(a.date));
localStorage.setItem("records",JSON.stringify(data));
img1.value=""; img2.value=""; desc.value=""; date.value="";
updateBackupInfo();
render();
return;
}

let loaded=0;
files.forEach(f=>{
let reader=new FileReader();
reader.onload=e=>{
r.imgs.push(e.target.result);
loaded++;
if(loaded===files.length){
data.push(r);
data.sort((a,b)=>new Date(b.date)-new Date(a.date));
localStorage.setItem("records",JSON.stringify(data));
img1.value=""; img2.value=""; desc.value=""; date.value="";
updateBackupInfo();
render();
}
};
reader.readAsDataURL(f.files[0]);
});
}

function updateBackupInfo(){
let now=new Date();
lastBackup.innerText="Son yedekleme: "+now.toLocaleDateString("tr-TR")+" "+now.toLocaleTimeString("tr-TR");
}

function render(filter=""){
home.innerHTML="";
home.appendChild(document.getElementById("searchBar")); // sabit arama kutusu
data.filter(r=>r.desc.toLowerCase().includes(filter.toLowerCase()))
.forEach((r,i)=>{
let c=document.createElement("div");
c.className="card";
let imgHtml=r.imgs.length>0?`<img src="${r.imgs[0]}">`:"";
c.innerHTML=`${imgHtml}
<div>
<b>${formatDateTR(r.date)}</b><br>${r.desc}
<div class="iconbar">
  <span onclick="edit(${i})">âœï¸</span>
  <span onclick="delRec(${i})">ğŸ—‘ï¸</span>
</div>
</div>`;
c.onclick=()=>openDetail(i);
home.appendChild(c);
});
}

function formatDateTR(d){
let dt=new Date(d);
return dt.toLocaleDateString("tr-TR");
}

function filterRecords(val){
render(val);
}

function delRec(i){
if(!confirm("Silmek istediÄŸine emin misin?"))return;
trash.push({...data[i],deleted:Date.now()});
data.splice(i,1);
localStorage.setItem("records",JSON.stringify(data));
localStorage.setItem("trash",JSON.stringify(trash));
render();
}

function showTrash(){
let html="";
trash.forEach((t,i)=>{
html+=`
<div class="trashItem">
<div>${formatDateTR(t.date)}<br>${t.desc}</div>
<div class="trashIcons">
  <span onclick="restore(${i})">â™»ï¸</span>
  <span onclick="perma(${i})">ğŸ—‘ï¸</span>
</div>
</div>`;
});
document.getElementById("trash").innerHTML=html;
}

function restore(i){
data.push(trash[i]);
trash.splice(i,1);
localStorage.setItem("records",JSON.stringify(data));
localStorage.setItem("trash",JSON.stringify(trash));
showTrash();
render();
}

function perma(i){
if(!confirm("KalÄ±cÄ± olarak silinsin mi?"))return;
trash.splice(i,1);
localStorage.setItem("trash",JSON.stringify(trash));
showTrash();
}

function openDetail(i){
let r=data[i];
let imgsHtml=r.imgs.map(src=>`<img src="${src}" style="width:49%;margin-right:2%">`).join("");
detail.innerHTML=`
<div style="background:#fff;padding:10px;border-radius:8px">
${imgsHtml}
<div class="text">${formatDateTR(r.date)}<br>${r.desc}</div>
<button onclick="show('home')">Geri</button>
</div>`;
show("detail");
}

async function exportZip(){
let s=s1.value,e=s2.value;
let zip=new JSZip();
data.filter(r=>r.date>=s&&r.date<=e)
.forEach((r,i)=>zip.file(`k${i}.json`,JSON.stringify(r)));
let blob=await zip.generateAsync({type:"blob"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download=`${s}_${e}.zip`;a.click();
}

async function importZip(){
let file=zipInput.files[0];
let zip=await JSZip.loadAsync(file);
for(let f in zip.files){
let txt=await zip.files[f].async("string");
data.push(JSON.parse(txt));
}
localStorage.setItem("records",JSON.stringify(data));
alert("YÃ¼klendi");
render();
}

function edit(i){
alert("DÃ¼zenleme fonksiyonu istersen sonra ekleriz ğŸ˜„");
}

render();
</script>
</body>
</html>
